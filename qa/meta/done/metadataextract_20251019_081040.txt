# SAP SuccessFactors Metadata Extraction Report
## Employee Consolidated Leave Balance & Request Functionality

### Executive Summary
This metadata extraction analyzes the current state and future requirements for consolidated leave management in SAP SuccessFactors Employee Central, focusing on concurrent employment scenarios and the proposed BTP extension solution.

### 1. Core Entity Sets Analysis

#### 1.1 Employee Central Core Entities
- **EmploymentInfo** - Contains assignment-level employment details
- **JobInfo** - Stores job-related information including assignment-specific data
- **PersonalInfo** - Person-level information
- **TimeAccount** - Leave balance management per assignment
- **TimeOff** - Leave request and approval tracking
- **TimeType** - Leave type definitions and configurations

#### 1.2 Foundation Objects (FO) Dependencies
- **FOCompany** - Company-level configurations
- **FODepartment** - Department structures
- **FOJobCode** - Job code definitions
- **FOPayComponent** - Pay component configurations
- **FOPosition** - Position management

#### 1.3 MDF (Metadata Framework) Objects
- **TimeAccountType** - Leave type configurations
- **TimeAccountBalance** - Assignment-specific balance tracking
- **TimeOffRequest** - Request management per assignment
- **TimeOffApproval** - Approval workflow configurations

### 2. Time Off Data Model Metadata

#### 2.1 TimeAccount Entity Structure
```
TimeAccount {
  - userId: string (key)
  - accountType: string (foreign key to TimeAccountType)
  - assignmentId: string (key)
  - currentBalance: decimal
  - entitlement: decimal
  - effectiveStartDate: date
  - effectiveEndDate: date
  - createdBy: string
  - createdOn: datetime
  - lastModifiedBy: string
  - lastModifiedOn: datetime
}
```

#### 2.2 TimeAccountBalance Fields
- **balance** - Current leave balance (decimal)
- **accrualRate** - Assignment-specific accrual rate (decimal)
- **fteAdjustment** - FTE conversion factor (decimal)
- **awardType** - Associated award/collective agreement (string)
- **assignmentType** - Role-specific assignment type (string)

#### 2.3 TimeOffRequest Entity
```
TimeOffRequest {
  - requestId: string (key)
  - userId: string
  - assignmentId: string (key)
  - timeAccountType: string
  - startDate: date
  - endDate: date
  - status: string
  - approverId: string
  - amount: decimal
  - workSchedule: string
}
```

### 3. Concurrent Employment Metadata

#### 3.1 Assignment-Level Metadata
- **AssignmentId** - Unique identifier for each employment assignment
- **AssignmentType** - Teacher, Teacher Aide, Public Service Operator
- **AwardType** - Collective agreement type per assignment
- **FTEPercentage** - Full-time equivalent percentage
- **WorkSchedule** - Assignment-specific work schedule

#### 3.2 Leave Entitlement Dependencies
- **EntitlementMatrix** - Per-assignment leave entitlement rules
- **AccrualLookupTable** - Job information attribute mappings
- **PolicyCompliance** - Award-specific compliance rules
- **FTEConversionRules** - Balance adjustment logic

### 4. Integration Metadata Framework

#### 4.1 OData API Endpoints
- **/odata/v2/TimeAccount** - Time account balance retrieval
- **/odata/v2/TimeOffRequest** - Leave request management
- **/odata/v2/EmploymentInfo** - Assignment information
- **/odata/v2/JobInfo** - Job-related data
- **/odata/v2/TimeAccountType** - Leave type configurations

#### 4.2 Data Normalization Requirements
- **Temporal Data Management** - Effective start/end date preservation
- **Conflict Resolution** - Retroactive change handling
- **Version Control** - Audit trail maintenance
- **Standardized Formats** - Consistent field mappings

### 5. BTP Extension Metadata

#### 5.1 Custom MDF Objects for Consolidation
```
ConsolidatedLeaveBalance {
  - userId: string (key)
  - totalBalance: decimal
  - assignmentBalances: collection
  - fteAdjustedTotal: decimal
  - lastCalculated: datetime
  - calculationMethod: string
}
```

#### 5.2 SAP Build App Metadata
- **Application ID**: EmployeeConsolidatedLeaveBalance
- **UI5 Component**: LeaveBalanceDashboard
- **Backend Service**: TimeAccountConsolidationService
- **Security Role**: LeaveBalanceViewRole

### 6. Field Definitions and Properties

#### 6.1 Critical Fields for Leave Consolidation
- **userId** (String, Required) - Employee identifier
- **assignmentId** (String, Required) - Assignment identifier  
- **timeAccountType** (String, Required) - Leave type identifier
- **currentBalance** (Decimal, Required) - Current balance amount
- **ftePercentage** (Decimal, Required) - FTE conversion factor
- **awardType** (String, Required) - Collective agreement type
- **effectiveDate** (Date, Required) - Balance effective date

#### 6.2 FTE Conversion Fields
- **fteAdjustmentFactor** - Conversion multiplier for part-time employees
- **proRataCalculation** - Proportional leave calculation method
- **balanceConversionDate** - Date of FTE change impact

### 7. Picklist Metadata

#### 7.1 Time Account Type Picklists
- **LEAVE_TYPES**: Annual Leave, Sick Leave, Personal Leave, Long Service Leave
- **AWARD_TYPES**: Teacher Award, Public Service Award, Support Staff Award
- **ASSIGNMENT_TYPES**: Teacher, Teacher Aide, Public Service Operator
- **STATUS_VALUES**: Active, Inactive, Pending, Converted

### 8. Business Rules Metadata

#### 8.1 Leave Balance Calculation Rules
- **AssignmentSeparationRule** - Balances managed independently per assignment
- **FTEConversionRule** - Balance adjustment on FTE changes
- **AwardComplianceRule** - Award-specific entitlement validation
- **AccrualRateRule** - Assignment-specific accrual calculations

#### 8.2 Validation Business Rules
- **ConcurrentAssignmentValidation** - Multi-assignment eligibility check
- **LeaveTypeValidation** - Assignment-appropriate leave type validation
- **ApproverRoutingRule** - Assignment-specific approval routing
- **WorkScheduleValidation** - Schedule-based leave validation

### 9. Security and Permission Metadata

#### 9.1 Role-Based Permissions
- **LeaveBalanceViewRole** - Read access to consolidated balances
- **LeaveRequestCreateRole** - Create leave requests across assignments
- **LeaveApproveRole** - Assignment-specific approval permissions
- **AdminLeaveManageRole** - Administrative leave management

#### 9.2 Field-Level Security
- **TimeAccount.balance** - Restricted to employee and manager
- **TimeAccount.entitlement** - HR and management access only
- **Assignment.ftePercentage** - Payroll and HR access

### 10. Workflow and Approval Metadata

#### 10.1 Time Off Approval Workflows
- **SingleAssignmentWorkflow** - Standard EC approval process
- **MultiAssignmentWorkflow** - Parallel approval for multiple assignments
- **DelegationWorkflow** - Manager delegation handling
- **ComplianceWorkflow** - Award-specific compliance checks

#### 10.2 Workflow Trigger Events
- **TimeOffRequest.created** - Request creation triggers
- **TimeAccount.balance.changed** - Balance change notifications
- **Assignment.fte.changed** - FTE change impact workflows

### 11. Integration Mapping Metadata

#### 11.1 EC to Payroll Integration
- **TimeAccountBalance** → **PayrollLeaveBalance**
- **TimeOffRequest** → **PayrollTimeOff**
- **AssignmentChange** → **PayrollAssignmentUpdate**

#### 11.2 BTP Extension Integration Points
- **OData Service**: TimeAccountConsolidationService
- **API Endpoint**: /sap/opu/odata/sap/SFEC_TIME_ACCOUNT_CONSOLIDATION
- **Integration Type**: Real-time data synchronization

### 12. Metadata Dependencies and Relationships

#### 12.1 Entity Relationships
```
EmploymentInfo (1) ←→ (M) JobInfo (Assignment Level)
JobInfo (M) ←→ (M) TimeAccount (Assignment Level)
TimeAccount (M) ←→ (M) TimeAccountBalance (Assignment Level)
TimeOffRequest (M) ←→ (1) TimeAccountType (Leave Type)
TimeOffRequest (M) ←→ (1) EmploymentInfo (Assignment Context)
```

#### 12.2 Cross-Module Dependencies
- **EC → Time Off**: Assignment-level leave management
- **EC → Payroll**: Balance and request data transmission
- **EC → BTP**: Consolidated view extension
- **Time Off → EC**: Approval and routing integration

### 13. Configuration Metadata

#### 13.1 Time Off Module Configuration
- **AssignmentLevelBalances** = true
- **SeparateEntitlementsPerAssignment** = true
- **FTEScalingEnabled** = true
- **ConcurrentAssignmentSupport** = true

#### 13.2 Custom Configuration Objects
- **LeaveBalanceConsolidationConfig** - BTP extension settings
- **AssignmentSeparationRules** - Multi-assignment processing rules
- **FTEConversionParameters** - Balance adjustment parameters

### 14. Data Quality and Audit Metadata

#### 14.1 Data Quality Rules
- **BalanceConsistencyCheck** - Assignment-level balance validation
- **FTEConversionAudit** - FTE change impact tracking
- **LeaveTypeCompliance** - Award-appropriate leave validation

#### 14.2 Audit Trail Requirements
- **TimeAccountBalanceChange** - Balance modification tracking
- **AssignmentLevelAccess** - Assignment-specific data access logs
- **ConsolidationCalculation** - BTP extension calculation audit

### 15. Metadata Extraction Summary

The metadata analysis reveals that SAP SuccessFactors Employee Central currently manages leave balances at the assignment level due to different awards and policies governing concurrent employment. The proposed BTP extension addresses the need for consolidated views while maintaining assignment-level accuracy and compliance. Key metadata components include assignment-specific TimeAccount entities, FTE conversion factors, award-based entitlement rules, and multi-assignment approval workflows.

The solution requires careful coordination between EC core entities, Time Off module configurations, and custom BTP extension objects to provide both consolidated views for employees and assignment-level accuracy for compliance purposes.