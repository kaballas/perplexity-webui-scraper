# SAP SuccessFactors Metadata Extraction Report
## E004b - Leave Request with Unpaid Units Enhancement

### Document Metadata
```
Document: HCMS - DoE Solution Design
Published: 10/12/2025, 10:02:54 PM
Section: Page 213-215
Feature: E004b - Leave Request with Unpaid Units
```

### Core Object Definitions

#### MDF Objects (Master Data Framework)
```
Object: LeaveRequestWithUnpaidUnits
- Type: Custom MDF Object
- Purpose: Handle combined paid/unpaid leave requests
- Parent: TimeOffRequest (standard EC object)
- Properties:
  - leaveRequestId (string, key)
  - employeeId (string, required)
  - leaveTypeId (string, required)
  - totalUnits (decimal, required)
  - paidUnits (decimal, required)
  - unpaidUnits (decimal, required)
  - hasUnpaidElement (boolean, calculated)
  - unpaidThresholdExceeded (boolean)
  - payrollPausedIndicator (boolean)
```

#### Foundation Objects
```
Object: LeaveTypeConfiguration
- Type: Foundation Object
- Purpose: Define leave type rules for unpaid elements
- Fields:
  - leaveTypeCode (string, key)
  - allowsUnpaidUnits (boolean)
  - unpaidThresholdLimit (integer)
  - zeroBalanceAllowed (boolean)
  - retrospectiveRequestAllowed (boolean)

Object: PayrollStatusIndicator
- Type: Foundation Object
- Purpose: Track payroll pause status for extended LWOP
- Fields:
  - personnelNumber (string, key)
  - payrollLockedIndicator (boolean)
  - payrollPauseStartDate (date)
  - payrollPauseEndDate (date)
```

### Field Definitions and Properties

#### Time Off Request Fields
```
Standard Fields Extended:
- timeTypeCode (string) - Leave type identifier
- startDate (date) - Leave start date
- endDate (date) - Leave end date
- totalDuration (decimal) - Total leave duration
- status (string) - Request status

Enhanced Fields:
- paidDuration (decimal, precision: 2)
- unpaidDuration (decimal, precision: 2)
- unpaidPercentage (decimal, calculated)
- employeeAcknowledgedUnpaid (boolean)
- splitRequestRequired (boolean)
```

#### Validation Fields
```
Validation Configuration:
- zeroBalanceAllowed (boolean)
- maxUnpaidThreshold (integer)
- allowRetrospective (boolean)
- payrollPauseRequired (boolean)
- extendedLWOPThreshold (integer, default: 9 days)
```

### Picklist Metadata

#### Leave Request Status Values
```
Picklist: LeaveRequestStatus
Values:
- INITIATED (Initial state)
- UNPAID_ACKNOWLEDGED (Employee accepted unpaid units)
- SPLIT_REQUESTED (Request split into paid/unpaid)
- APPROVAL_PENDING (Awaiting approval)
- APPROVED (Approved)
- REJECTED (Rejected)
- PAYROLL_PAUSED (Payroll suspended for extended LWOP)
```

#### Leave Type Categories
```
Picklist: LeaveTypeWithUnpaidPermission
Values:
- SICK_LEAVE (Permitted with unpaid units)
- ANNUAL_LEAVE (Not permitted)
- PERSONAL_LEAVE (Permitted with unpaid units)
- LONG_SERVICE_LEAVE (Not permitted)
- MATERNITY_LEAVE (Not permitted)
- PATERNITY_LEAVE (Not permitted)
```

### Business Rules and Validation Logic

#### System Validation Rules
```
Rule: ValidateUnpaidThreshold
- Condition: unpaidDuration > maxUnpaidThreshold
- Action: Reject request with error message
- Priority: High

Rule: CheckLeaveBalanceBeforeUnpaid
- Condition: leaveBalance < totalDuration AND allowsUnpaidUnits
- Action: Calculate paid/unpaid split
- Priority: Medium

Rule: PayrollPauseOnExtendedLWOP
- Condition: unpaidDuration > 9 working days
- Action: Set payroll end date to 31.12.9999
- Priority: Critical
```

#### Approval Workflow Rules
```
Workflow: MultiStageApprovalWithUnpaid
- Stage 1: Standard approval for paid portion
- Stage 2: Special approval for unpaid portion
- Stage 3: Payroll status update for extended LWOP
- Participants: Line Manager, Payroll Admin, HR
```

### Integration Mapping Metadata

#### EC to ECP Integration
```
Integration: LeaveRequestToPayroll
- Source: LeaveRequestWithUnpaidUnits
- Target: PayrollStatus (Infotype 0003)
- Fields:
  - payrollLockedIndicator → Personnel Number locked for payroll
  - payrollPauseStartDate → Payroll pause start date
  - payrollPauseEndDate → Payroll pause end date
```

#### BTP Extension Integration
```
Extension: E004b - Unpaid Leave Handler
- Type: SAP BTP Application
- Integration Points:
  - Employee Central Time Off UI
  - Leave Balance Calculation
  - Approval Workflow Engine
  - Payroll Status Update
```

### Security and Permission Metadata

#### Role-Based Access Control
```
Role: LeaveRequestWithUnpaidAccess
- Permissions:
  - Create LeaveRequestWithUnpaidUnits
  - Read LeaveBalance
  - Update PayrollStatus
  - TriggerApprovalWorkflow

Role: PayrollAdminExtendedLWOP
- Permissions:
  - Update Payroll Pause Status
  - Override Unpaid Thresholds
  - Access Payroll Status Records
```

#### Field-Level Security
```
Field Security:
- unpaidDuration: Read/Write for HR, Read for Managers
- payrollPausedIndicator: Read/Write for Payroll Admin only
- employeeAcknowledgedUnpaid: Read for all, Write for employee only
```

### Workflow Metadata

#### Business Workflow Definition
```
Workflow: CombinedPaidUnpaidLeaveRequest
- Initiator: Employee or Manager (via BTP App)
- Stages:
  1. Employee enters leave request
  2. System calculates paid/unpaid split
  3. Employee acknowledges unpaid portion
  4. Approval routing to multiple approvers
  5. Payroll status update (if extended LWOP)
- Conditions:
  - unpaidDuration > 0 triggers unpaid workflow
  - unpaidDuration > 9 triggers payroll pause
```

### Custom Field Definitions

#### Enhanced Leave Request Custom Fields
```
Custom Field: leaveRequestUnpaidSplit
- API Name: custom_unpaidSplit
- Data Type: JSON
- Purpose: Store detailed paid/unpaid breakdown
- Structure:
  {
    "paidUnits": decimal,
    "unpaidUnits": decimal,
    "totalUnits": decimal,
    "splitDate": date,
    "employeeAcknowledged": boolean
  }

Custom Field: payrollPauseRequired
- API Name: custom_payrollPauseRequired
- Data Type: boolean
- Purpose: Flag for extended LWOP processing
```

### API Endpoints and OData Metadata

#### Custom OData Services
```
Service: LeaveRequestUnpaidService
- Entity: LeaveRequestWithUnpaidUnits
- Operations:
  - GET /LeaveRequestWithUnpaidUnits
  - POST /LeaveRequestWithUnpaidUnits
  - PATCH /LeaveRequestWithUnpaidUnits(leaveRequestId)
  - Function: CalculateUnpaidSplit(startDate, endDate, leaveTypeCode)

Service: PayrollPauseService
- Entity: PayrollPauseIndicator
- Operations:
  - POST /SetPayrollPause(personnelNumber, startDate)
  - POST /ClearPayrollPause(personnelNumber, returnDate)
```

### Data Model Relationships

#### Object Relationships
```
Relationships:
Employee 1:M LeaveRequestWithUnpaidUnits
LeaveRequestWithUnpaidUnits 1:1 PayrollPauseIndicator
LeaveTypeConfiguration 1:M LeaveRequestWithUnpaidUnits
LeaveRequestWithUnpaidUnits M:1 ApprovalWorkflow
```

### Configuration Metadata

#### System Configuration Parameters
```
Configuration: LeaveUnpaidSettings
- Parameter: unpaidThreshold (integer, default: 9)
- Parameter: allowZeroBalanceLeave (boolean, default: false)
- Parameter: enableRetrospectiveRequests (boolean, default: false)
- Parameter: payrollPauseEndDate (date, default: 31.12.9999)
- Parameter: btpAppRequiredForUnpaid (boolean, default: true)
```

This metadata extraction provides comprehensive coverage of the E004b Leave Request with Unpaid Units enhancement, including all relevant object definitions, field properties, validation rules, and integration points required for implementation.