# SAP SuccessFactors Metadata Extraction Report
## Employee Consolidated Leave Balance & Request Functionality

### Executive Summary
This metadata extraction analyzes the current and future state of consolidated leave management for employees with concurrent assignments in SAP SuccessFactors Employee Central, focusing on the E003 and E004a requirements for Queensland DoE HCMS Programme.

### 1. Core Entity Metadata Analysis

#### 1.1 Employee Central Foundation Objects
```
Entity: EmploymentInfo
- Primary Key: employmentId
- Relationships: Person → EmploymentInfo → JobInfo
- Key Fields: employmentType, startDate, endDate, status
- Metadata Properties: Effective dating, concurrent employment support

Entity: JobInfo
- Primary Key: jobInfoId
- Relationships: EmploymentInfo → JobInfo
- Key Fields: positionTitle, jobCode, businessUnit, department, FTE
- Metadata Properties: Assignment-level data, temporal effective dating

Entity: TimeAccountDetails
- Primary Key: timeAccountDetailsId
- Relationships: Person → TimeAccountDetails
- Key Fields: assignmentId, timeAccountType, balance, accrualRate
- Metadata Properties: Assignment-specific balances, separate entitlement tracking
```

#### 1.2 Time Off Module Objects
```
Entity: TimeType
- Primary Key: timeTypeId
- Key Fields: timeTypeCode, timeTypeName, accrualRule, eligibilityCriteria
- Metadata Properties: Award-specific configurations, separate entitlements per assignment

Entity: TimeAccountBalance
- Primary Key: timeAccountBalanceId
- Key Fields: personId, assignmentId, timeType, balanceAmount, asOfDate
- Metadata Properties: Assignment-level balance storage, no consolidated view OOB

Entity: TimeOffRequest
- Primary Key: timeOffRequestId
- Key Fields: personId, assignmentId, timeType, startDate, endDate, status
- Metadata Properties: Assignment-specific requests, separate approval workflows
```

### 2. Current State Metadata Configuration

#### 2.1 Concurrent Employment Data Structure
```
Foundation Object: EmploymentType
- Code Values: "CONCURRENT", "SINGLE_ASSIGNMENT"
- Assignment Mapping: One-to-many relationship between Person and EmploymentInfo
- FTE Conversion Logic: Implemented via business rules on employment changes

Picklist: AssignmentLevelLeaveTypes
- Values: ["ANNUAL_LEAVE", "SICK_LEAVE", "PERSONAL_LEAVE", "LONG_SERVICE_LEAVE"]
- Assignment Dependencies: Different award-based configurations per assignment
- Validation Rules: Assignment-specific eligibility checks
```

#### 2.2 Time Account Balance Metadata
```
Field Definition: TimeAccountBalance.assignmentId
- Data Type: String(128)
- Mandatory: True
- Unique Constraint: Combination with personId and timeType
- Purpose: Separate balance tracking per assignment

Field Definition: TimeAccountBalance.balanceAmount
- Data Type: Decimal(15,2)
- FTE Adjustment: Applied via business rules during FTE changes
- Currency: Local currency per assignment
```

### 3. Enhancement Metadata Requirements

#### 3.1 BTP Application Integration Points
```
OData Service: /odata/v2/TimeAccountDetails
- Entity Sets: TimeAccountDetails, TimeAccountBalance
- Custom Query Options: $filter=personId eq '{personId}' and $expand=assignmentInfo
- BTP Extension Points: Custom consolidated view API

API Endpoint: /btp/consolidated-leave-balance
- Input Parameters: personId, asOfDate
- Output Structure: 
  - consolidatedBalances: Array of assignment-specific balances
  - totalBalances: Calculated summary (display only, not combinable)
  - assignmentDetails: Position title, FTE, award information
```

#### 3.2 Custom MDF Objects for Consolidation
```
Generic Object: ConsolidatedLeaveBalance
- Fields:
  - personId (String, 128, key)
  - assignmentId (String, 128, key)
  - positionTitle (String, 255)
  - ftePercentage (Decimal, 5,4)
  - timeType (String, 128)
  - currentBalance (Decimal, 15,2)
  - projectedBalance (Decimal, 15,2)
  - lastUpdated (DateTime)

Generic Object: ConsolidatedLeaveRequest
- Fields:
  - requestId (String, 128, key)
  - personId (String, 128)
  - requestDate (DateTime)
  - status (String, 32)
  - assignmentsAffected (String, 1024) - JSON array
```

### 4. Business Rule Metadata

#### 4.1 FTE Conversion Business Rules
```
Rule Name: FTE_Leave_Balance_Conversion
- Trigger Event: employmentInfo.change
- Conditions: 
  - old.FTE != new.FTE
  - employment.status = 'ACTIVE'
- Actions:
  - Calculate new balance = oldBalance * (new.FTE / old.FTE)
  - Update TimeAccountBalance for affected assignment
- Validation: Ensure balance accuracy within 0.01 tolerance

Rule Name: Assignment_Specific_Entitlements
- Trigger Event: timeOffRequest.create
- Conditions:
  - Person has multiple assignments
  - Request spans multiple assignments
- Actions:
  - Validate leave type eligibility per assignment
  - Check balance availability per assignment
  - Route to appropriate assignment manager
```

### 5. Workflow and Approval Metadata

#### 5.1 Multi-Assignment Approval Workflow
```
Workflow Template: MultiAssignmentLeaveApproval
- Initiator: Employee or Manager/HR Admin
- Steps:
  1. Assignment Manager Approval (parallel for each affected assignment)
  2. HR Admin Review (if required based on leave type)
  3. Payroll Integration (post-approval)
- Routing Logic: 1Up Manager lookup per assignmentId
- Delegation Support: Standard SuccessFactors delegation framework

Approval Matrix:
- Assignment A Manager: Approves leave for Assignment A
- Assignment B Manager: Approves leave for Assignment B
- Cross-assignment visibility: Limited to respective assignments
```

### 6. Integration Metadata Dependencies

#### 6.1 Payroll Integration Points
```
Integration Specification: EC_to_Payroll_Leave_Balance
- Source: TimeAccountBalance, JobInfo
- Target: Payroll system leave balance fields
- Frequency: Real-time for balance changes
- Transformation: Assignment-specific balance mapping to payslip

Integration Specification: BTP_to_EC_TimeOff
- Source: ConsolidatedLeaveRequest (BTP app)
- Target: TimeOffRequest (EC)
- Frequency: Event-driven on request submission
- Transformation: Split consolidated request into assignment-specific requests
```

### 7. Security and Permission Metadata

#### 7.1 Role-Based Permissions
```
Role: Employee_Consolidated_Leave_View
- Permissions:
  - Read: TimeAccountBalance (person-level filter)
  - Read: JobInfo (own assignments only)
  - Read: ConsolidatedLeaveBalance (own data only)

Role: Manager_Consolidated_Leave_View
- Permissions:
  - Read: Subordinates' consolidated balances
  - Read: Assignment details for managed employees
  - No: Balance combination across assignments

Role: HR_Admin_Consolidated_Management
- Permissions:
  - Full access to consolidated views
  - Assignment-level balance management
  - FTE conversion oversight
```

### 8. Data Quality and Validation Metadata

#### 8.1 Validation Rules for Consolidated Functionality
```
Validation Rule: LeaveType_Award_Compliance
- Scope: Multi-assignment leave requests
- Logic: Validate timeType availability per assignment award
- Error Handling: Reject request with specific assignment/award mismatch

Validation Rule: Balance_Availability_Check
- Scope: Per assignment in consolidated request
- Logic: Check sufficient balance for each affected assignment
- Action: Validate total request against individual assignment balances

Validation Rule: Work_Schedule_Conformance
- Scope: Multi-assignment work schedule combination
- Logic: Validate leave dates against assignment-specific work schedules
- Resolution: Apply assignment-specific schedule rules to date ranges
```

### 9. Reporting and Analytics Metadata

#### 9.1 Custom Reports for Consolidated Leave
```
Report: Employee_Consolidated_Leave_Summary
- Data Sources: TimeAccountBalance, JobInfo, PersonInfo
- Filters: Person, Date Range, Assignment
- Output: Assignment-level balances with position context

Report: Manager_Consolidated_Leave_View
- Data Sources: Subordinate TimeAccountBalance, Assignment details
- Filters: Manager, Organization, Date Range
- Output: Team consolidated balance view (assignment-separated)
```

### 10. Technical Implementation Metadata

#### 10.1 BTP Application Specifications
```
Application: Employee_Consolidated_Leave_Balance
- Technology: SAP Build App
- Backend: OData API integration with EC
- Frontend: Fiori elements-based UI
- Caching: Assignment balance data for performance
- Security: SAP Cloud Identity Services integration

Integration API: /api/v1/consolidated-leave
- Methods: GET /balances, POST /request
- Authentication: OAuth 2.0 with EC token validation
- Rate Limiting: 100 requests per minute per user
```

### 11. Metadata Quality Assessment

#### 11.1 Current State Gaps Identified
- **High Severity**: Missing validation logic for assignment-specific entitlements
- **Medium Severity**: Incomplete field mapping for leave accrual lookup tables  
- **Low Severity**: Temporal data management for retroactive changes

#### 11.2 Enhancement Dependencies
- **Blocking**: Detailed validation logic for leave types and routing across assignments
- **Integration**: EC to Payroll integration specification for consolidated balances
- **Security**: Role-based permission matrix for consolidated views

### 12. Recommendations

1. **Immediate Actions**: 
   - Implement assignment-level balance validation rules
   - Define comprehensive picklist values for award-specific leave types
   - Establish BTP application integration endpoints

2. **Phase 2 Enhancements**:
   - Develop advanced FTE conversion business rules
   - Create consolidated reporting framework
   - Implement workflow optimization for multi-assignment approvals

3. **Long-term Considerations**:
   - Plan for SAP Joule AI integration for leave requests
   - Consider standard product evolution alignment
   - Evaluate future roadmap compatibility

This metadata extraction provides the foundation for implementing consolidated leave management functionality while maintaining compliance with Queensland DoE requirements for separate assignment-based entitlement management.