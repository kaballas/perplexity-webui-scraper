# Metadata Extraction Report: BTP Enhancement E024 - Auto Time-Off Leave Payout on Termination

## Executive Summary
This metadata extraction focuses on the BTP Enhancement E024 designed for automated leave payout processing during employee termination in the Queensland Department of Education's SAP SuccessFactors HCMS implementation.

## 1. Core Entity Sets (OData API)

### 1.1 Termination-Related Entities
```
Entity: TerminationInfo
- Key Fields: 
  - terminationId (String, 32 chars)
  - userId (String, 100 chars)
  - startDate (DateTime)
  - endDate (DateTime)
  - terminationReason (String, 100 chars)
  - terminationType (String, 50 chars)
  - status (String, 30 chars)
- Relationships: 
  - One-to-Many with JobInfo (via userId)
  - One-to-Many with TimeAccountBalances (via userId)

Entity: TerminationLeavePayoutConfig
- New Custom Entity (Enhancement E024)
- Key Fields:
  - payoutId (String, 32 chars)
  - userId (String, 100 chars)
  - terminationId (String, 32 chars)
  - leavePayoutFlag (String, 10) - Enum: ['PAY_OUT', 'CLEAR', 'NO_ACTION']
  - defaultPayoutFlag (String, 10) - Default: 'PAY_OUT'
  - createdTimestamp (DateTime)
  - updatedTimestamp (DateTime)
```

### 1.2 Time Account Entities
```
Entity: TimeAccountBalances
- Key Fields:
  - timeAccountBalanceId (String, 32 chars)
  - userId (String, 100 chars)
  - timeType (String, 50 chars)
  - balance (Decimal, 15,2)
  - effectiveStartDate (DateTime)
  - effectiveEndDate (DateTime)
  - currency (String, 3 chars)

Entity: TimeAccountTransactions
- Key Fields:
  - transactionId (String, 32 chars)
  - userId (String, 100 chars)
  - timeType (String, 50 chars)
  - transactionType (String, 20) - Enum: ['ACCRUAL', 'USAGE', 'PAYOUT', 'ADJUSTMENT']
  - amount (Decimal, 15,2)
  - transactionDate (DateTime)
  - payrollPeriod (String, 10)
```

## 2. Master Data Framework (MDF) Objects

### 2.1 Custom MDF Object: TerminationLeavePayoutConfiguration
```
Object Name: TerminationLeavePayoutConfiguration
- Type: MDF (Master Data Framework)
- Fields:
  - payoutRuleId (String, 32 chars) - Primary Key
  - ruleName (String, 200 chars) - UI Label: "Payout Rule Name"
  - leavePayoutIndicator (Picklist) - UI Label: "Leave Payout Indicator"
    - Picklist Values: 
      - PAY_OUT: "Leave Balances are to be paid out" (Default)
      - CLEAR: "Leave Balances are to be cleared (no payout)"
      - NO_ACTION: "No Action"
  - defaultForSelfService (Boolean) - Default: true
  - effectiveStartDate (DateTime)
  - effectiveEndDate (DateTime)
  - createdBy (String, 100 chars)
  - createdOn (DateTime)
  - modifiedBy (String, 100 chars)
  - modifiedOn (DateTime)
```

### 2.2 Extended Termination Object
```
Object Name: TerminationInfo (Extended)
- Additional Fields Added:
  - leavePayoutFlag (String, 10 chars) - Enum: ['PAY_OUT', 'CLEAR', 'NO_ACTION']
  - payoutProcessedDate (DateTime)
  - payoutProcessedBy (String, 100 chars)
  - payrollIntegrationStatus (String, 20 chars) - Enum: ['PENDING', 'PROCESSED', 'FAILED']
```

## 3. Foundation Objects (FO) Relationships

### 3.1 Termination Reason Foundation Object
```
Foundation Object: FO_TerminationReason
- Key Fields:
  - code (String, 100 chars) - Primary Key
  - externalCode (String, 100 chars)
  - name (String, 200 chars)
  - description (String, 500 chars)
  - defaultPayoutSetting (String, 10 chars) - Reference to payout flag
- Relationships:
  - Many-to-One with TerminationInfo
  - One-to-Many with TerminationLeavePayoutConfiguration
```

## 4. Picklist Metadata

### 4.1 Leave Payout Flag Picklist
```
Picklist ID: leavePayoutFlag
- Type: Standard Picklist
- Values:
  - Code: PAY_OUT
    - Default: true
    - Status: Active
    - Localized Labels:
      - en_US: "Leave Balances are to be paid out"
  
  - Code: CLEAR
    - Default: false
    - Status: Active
    - Localized Labels:
      - en_US: "Leave Balances are to be cleared (no payout)"
  
  - Code: NO_ACTION
    - Default: false
    - Status: Active
    - Localized Labels:
      - en_US: "No Action"
```

### 4.2 Termination Type Picklist
```
Picklist ID: terminationType
- Values:
  - VOLUNTARY: "Voluntary Termination"
  - INVOLUNTARY: "Involuntary Termination" 
  - FIXED_TERM: "Fixed Term Termination"
  - CASUAL: "Casual Termination"
  - RETROSPECTIVE: "Retrospective Termination"
```

## 5. Field Definitions and Properties

### 5.1 TerminationLeavePayoutFlag Field
```
Field Name: leavePayoutFlag
- Object: TerminationInfo
- Data Type: String
- Length: 10 characters
- Required: false (with default)
- Default Value: "PAY_OUT"
- UI Label: "Leave Payout Action"
- Security: Read/Write for HR Admins, Read-only for Managers, Hidden for Employees
- Validation: Must be one of the defined picklist values
- Effective Dated: No
```

### 5.2 Termination Date Field (Enhanced)
```
Field Name: terminationDate
- Object: TerminationInfo
- Data Type: DateTime
- Required: true
- Validation: 
  - Must be >= current date for future-dated terminations
  - Must be <= current date for retrospective terminations
- Business Rule: Triggers BTP event processing
```

## 6. BTP Integration Layer Metadata

### 6.1 BTP Event Table Structure
```
Table Name: BTP_TerminationEvents
- Fields:
  - eventId (UUID) - Primary Key
  - employeeId (String, 100 chars)
  - terminationDate (DateTime)
  - leavePayoutFlag (String, 10 chars)
  - eventTimestamp (DateTime)
  - processingStatus (String, 20 chars) - Enum: ['PENDING', 'PROCESSED', 'FAILED']
  - nextProcessingDate (DateTime)
  - retryCount (Integer)
```

### 6.2 API Endpoints
```
Endpoint: /odata/v2/TerminationLeavePayoutConfig
- Methods: GET, POST, PUT, PATCH
- Authentication: OAuth 2.0
- Rate Limit: 1000 requests/minute

Endpoint: /odata/v2/BTP_TerminationEvents
- Methods: GET, POST
- Purpose: Event trigger and processing queue
```

## 7. Workflow and Business Rule Metadata

### 7.1 Termination Approval Workflow
```
Workflow ID: WF_TerminationApproval_E024
- Trigger: TerminationInfo record creation/updated
- Steps:
  1. Manager Approval (for self-service terminations)
  2. HR Validation
  3. BTP Event Creation
  4. Payroll Integration Trigger

Business Rule: BR_LeavePayoutValidation
- Object: TerminationInfo
- Trigger: onSave
- Logic: Validates leavePayoutFlag against terminationType and self-service flag
- Permissions: Prevents self-service users from changing default payout flag
```

## 8. Integration Mapping Metadata

### 8.1 Time PTP Replication Mapping
```
Source: TimeAccountBalances
Target: Employee Central Payroll
Mapping Fields:
- userId → employeeId
- timeType → payComponentCode
- balance → payoutAmount
- transactionDate → paymentDate
- transactionType → 'PAYOUT' (constant)

Integration Frequency: Daily (or ad-hoc for special cases)
Batch Size: 1000 records per batch
Error Handling: Retry 3 times, then move to error queue
```

### 8.2 Payroll Integration Endpoints
```
Endpoint: /payroll/termination-payout
- Method: POST
- Content-Type: application/json
- Expected Payload:
  {
    "employeeId": "string",
    "payoutItems": [
      {
        "payComponent": "string",
        "amount": "decimal",
        "currency": "string",
        "effectiveDate": "datetime"
      }
    ],
    "payrollPeriod": "string"
  }
```

## 9. Security and Permission Metadata

### 9.1 Role-Based Access Control
```
Role: HR_Administrator
- Permissions:
  - TerminationLeavePayoutConfig: Full CRUD
  - TerminationInfo.leavePayoutFlag: Read/Write
  - BTP_TerminationEvents: Read/Write

Role: Manager
- Permissions:
  - TerminationInfo.leavePayoutFlag: Read Only (for subordinates)
  - TerminationLeavePayoutConfig: Read Only

Role: Employee
- Permissions:
  - TerminationInfo.leavePayoutFlag: No Access (default remains PAY_OUT for self-service)
```

## 10. Data Quality and Validation Rules

### 10.1 Data Validation Rules
```
Rule: VR_FutureDatedTermination
- Object: TerminationInfo
- Field: terminationDate
- Logic: If terminationType = 'FUTURE_DATED', then terminationDate > current_date

Rule: VR_LeavePayoutConsistency
- Object: TerminationInfo
- Logic: If terminationType = 'SELF_SERVICE', then leavePayoutFlag = 'PAY_OUT' (cannot be changed)
```

### 10.2 Audit Trail Requirements
```
Audited Fields:
- TerminationInfo.leavePayoutFlag
- TerminationInfo.terminationDate
- TimeAccountBalances.balance (on payout)
- BTP_TerminationEvents.processingStatus

Audit Trail: Maintain effective dating and user tracking for all changes
Retention: 7 years (compliance requirement)
```

## 11. Configuration Dependencies

### 11.1 System Configuration Requirements
```
Required Configurations:
- Payroll Control Center integration setup
- Time PTP Replication configuration
- BTP Integration Suite activation
- OData API permissions for custom entities
- Workflow engine configuration for approval processes
```

## 12. Metadata Summary

The BTP Enhancement E024 introduces comprehensive metadata changes to support automated leave payout processing on termination, including custom MDF objects, extended foundation objects, specialized picklists, and integration mappings. The solution addresses future-dated, same-day, and retrospective terminations while maintaining data integrity and compliance requirements for the Queensland Department of Education's HCMS implementation.